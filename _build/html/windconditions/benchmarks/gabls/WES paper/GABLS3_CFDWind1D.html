
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>Assessment of meso-micro offline coupling methodology based on driving CFDWind single-column-model with WRF tendencies: the GABLS3 diurnal cycle case &#8212; Wind Energy Model Evaluation Protocol</title>
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '1.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true,
        SOURCELINK_SUFFIX: '.txt'
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <link rel="index" title="Index" href="../../../../genindex.html" />
    <link rel="search" title="Search" href="../../../../search.html" />
    <link rel="prev" title="GABLS 3 Diurnal-Cycle Benchmark for Wind Energy Applications" href="../NEWAbenchmark/GABLS3DiurnalCycleBenchmarkForWindEnergy_2017.html" />
   
  <link rel="stylesheet" href="../../../../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head>
  <body>
  

    <div class="document">
  <div class="documentwrapper">
    <div class="bodywrapper">
      <div class="body" role="main">
          
          <div class="breadcrumbs">
            
            
              <a href="../../../../index.html">Home</a> &raquo;
                
                  <a href="../../../index.html">Wind Conditions</a> &raquo;
                
                  <a href="../gabls.html">GABLS Atmospheric Boundary Layer</a> &raquo;
                
                  <a href="../gabls3.html">GABLS3 Diurnal Cycle in Flat Terrain Leading to a Nocturnal Low-Level Jet</a> &raquo;
                
            
          </div>
        
        
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput,
div.nbinput div.prompt,
div.nbinput div.input_area,
div.nbinput div[class*=highlight],
div.nbinput div[class*=highlight] pre,
div.nboutput,
div.nbinput div.prompt,
div.nbinput div.output_area,
div.nboutput div[class*=highlight],
div.nboutput div[class*=highlight] pre {
    background: none;
    border: none;
    padding: 0 0;
    margin: 0;
    box-shadow: none;
}

/* avoid gaps between output lines */
div.nboutput div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput,
div.nboutput {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput,
    div.nboutput {
        flex-direction: column;
    }
}

/* input container */
div.nbinput {
    padding-top: 5px;
}

/* last container */
div.nblast {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput div.prompt pre {
    color: #303F9F;
}

/* output prompt */
div.nboutput div.prompt pre {
    color: #D84315;
}

/* all prompts */
div.nbinput div.prompt,
div.nboutput div.prompt {
    min-width: 8ex;
    padding-top: 0.4em;
    padding-right: 0.4em;
    text-align: right;
    flex: 0;
}
@media (max-width: 540px) {
    div.nbinput div.prompt,
    div.nboutput div.prompt {
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput div.prompt.empty {
        padding: 0;
    }
}

/* disable scrollbars on prompts */
div.nbinput div.prompt pre,
div.nboutput div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput div.input_area,
div.nboutput div.output_area {
    padding: 0.4em;
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput div.input_area,
    div.nboutput div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput div.input_area {
    border: 1px solid #cfcfcf;
    border-radius: 2px;
    background: #f7f7f7;
}

/* override MathJax center alignment in output cells */
div.nboutput div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.pngmath center alignment in output cells */
div.nboutput div.math p {
    text-align: left;
}

/* standard error */
div.nboutput div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }
</style>
<div class="section" id="Assessment-of-meso-micro-offline-coupling-methodology-based-on-driving-CFDWind-single-column-model-with-WRF-tendencies:-the-GABLS3-diurnal-cycle-case">
<h1>Assessment of meso-micro offline coupling methodology based on driving CFDWind single-column-model with WRF tendencies: the GABLS3 diurnal cycle case<a class="headerlink" href="#Assessment-of-meso-micro-offline-coupling-methodology-based-on-driving-CFDWind-single-column-model-with-WRF-tendencies:-the-GABLS3-diurnal-cycle-case" title="Permalink to this headline">¶</a></h1>
<p><em>Javier Sanz Rodrigo, National Renewable Energy Laboratory (CENER),
Sarriguren, Spain, jsrodrigo&#64;cener.com</em></p>
<p>April 2017</p>
<div class="section" id="Introduction">
<h2>Introduction<a class="headerlink" href="#Introduction" title="Permalink to this headline">¶</a></h2>
<p>This notebook provides the model evaluation process developed for the
assessment of a methodology for testing atmospheric boundary layer
models under realistic mesoscale forcing. Tendencies from WRF are used
as inputs for CFDWind single-column-model (SCM) to reproduce the GABLS3
diurnal cycle at the Cabauw site. A sensitivity test is conducted to
test different SCM settings as well as profile nudging to dynamically
correct for model bias.</p>
<p>This work has been used to set up a benchmark for other wind energy
models dealing with meso-micro coupling. The benchmark was launched at
the Torque 2016 conference [1] and the results of this study with
CFDWind1D have been published in [2].</p>
</div>
<div class="section" id="Benchmark-Set-Up">
<h2>Benchmark Set-Up<a class="headerlink" href="#Benchmark-Set-Up" title="Permalink to this headline">¶</a></h2>
<p>Background information and benchmark set-up can be found in:
<a class="reference external" href="http://windbench.net/gabls-3">http://windbench.net/gabls-3</a></p>
</div>
<div class="section" id="CFDWind1D-Simulations">
<h2>CFDWind1D Simulations<a class="headerlink" href="#CFDWind1D-Simulations" title="Permalink to this headline">¶</a></h2>
<p>The following simulations were conducted in the sensitivity analysis to
target the following model evaluation objectives:</p>
<ol class="arabic simple">
<li>Demonstrate consistency of online (WRF) vs asynchronous meso-micro
coupling</li>
<li>Evaluate the choice of turbulent closure with realistic forcing</li>
<li>Quantify the impact of the choice of surface boundary conditions on
fluxes and quantities of interest</li>
<li>Quantify the relative importance of mesoscale tendencies on
quantities of interest</li>
<li>Assess bias-correction nudging method using typical wind energy mast
configurations</li>
<li>Assess bias-correction nudging method using typical wind energy lidar
configurations</li>
</ol>
<table border="1" class="docutils">
<colgroup>
<col width="11%" />
<col width="14%" />
<col width="25%" />
<col width="20%" />
<col width="30%" />
</colgroup>
<thead valign="bottom">
<tr class="row-odd"><th class="head">SimID</th>
<th class="head">Turbule
nce</th>
<th class="head">Surface B.C.</th>
<th class="head">Forcing</th>
<th class="head">Objectives</th>
</tr>
</thead>
<tbody valign="top">
<tr class="row-even"><td>WRF-Y
SU</td>
<td>YSU</td>
<td>Noah</td>
<td>ERA Interim</td>
<td>1</td>
</tr>
<tr class="row-odd"><td>ke_T2
(ref)</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td>WRF
tendencies</td>
<td>1</td>
</tr>
<tr class="row-even"><td>Sl_T2</td>
<td>:math:`
S-l`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td>WRF
tendencies</td>
<td>2</td>
</tr>
<tr class="row-odd"><td>kl_T2</td>
<td>:math:`
k-l`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td>WRF
tendencies</td>
<td>2</td>
</tr>
<tr class="row-even"><td>ke_T2
wt</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span>
and
<span class="math">\(w\theta
_0\)</span></td>
<td>WRF
tendencies</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>ke_Ts
k</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(\Theta_
0\)</span></td>
<td>WRF
tendencies</td>
<td>3</td>
</tr>
<tr class="row-even"><td>ke_T2
obs</td>
<td>:math:`
k-epsi
lon`</td>
<td>Observed
<span class="math">\(T_2\)</span></td>
<td>WRF
tendencies</td>
<td>3</td>
</tr>
<tr class="row-odd"><td>noTad
v</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td>without
<span class="math">\(\The
ta_{adv}\)</span>
tendency</td>
<td>4</td>
</tr>
<tr class="row-even"><td>noTad
vUadv</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td>without
advection
tendencies</td>
<td>4</td>
</tr>
<tr class="row-odd"><td>noTad
vUadv
_Sg0</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td>only
surface
pressure
gradient</td>
<td>4</td>
</tr>
<tr class="row-even"><td>UVTnu
d80</td>
<td>:math:`
k-epsi
lon`</td>
<td>Observed
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
10-80 m;
<span class="math">\(\The
ta\)</span>:
2-80 m;
<span class="math">\(\tau
_{nud}\)</span>
= 60 min</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>UVTnu
d120</td>
<td>:math:`
k-epsi
lon`</td>
<td>Observed
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
10-120 m;
<span class="math">\(\The
ta\)</span>:
2-120 m;
<span class="math">\(\tau
_{nud}\)</span>
= 60 min</td>
<td>5</td>
</tr>
<tr class="row-even"><td>UVTnu
d200</td>
<td>:math:`
k-epsi
lon`</td>
<td>Observed
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
10-200 m;
<span class="math">\(\The
ta\)</span>:
2-200 m;
<span class="math">\(\tau
_{nud}\)</span>
= 60 min</td>
<td>5</td>
</tr>
<tr class="row-odd"><td>UVTnu
<a href="#id1"><span class="problematic" id="id2">d200_</span></a>
tau10</td>
<td>:math:`
k-epsi
lon`</td>
<td>Observed
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
10-200 m;
<span class="math">\(\The
ta\)</span>:
2-200 m;
<span class="math">\(\tau
_{nud}\)</span>
= 10 min</td>
<td>5</td>
</tr>
<tr class="row-even"><td>UVnud
400</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
40-400 m;
<span class="math">\(\tau
_{nud}\)</span>
= 60 min</td>
<td>6</td>
</tr>
<tr class="row-odd"><td>UVnud
200</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
40-200 m;
<span class="math">\(\tau
_{nud}\)</span>
= 60 min</td>
<td>6</td>
</tr>
<tr class="row-even"><td>UVnud
200_t
au30</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
40-200 m;
<span class="math">\(\tau
_{nud}\)</span>
= 30 min</td>
<td>6</td>
</tr>
<tr class="row-odd"><td>UVnud
200_t
au10</td>
<td>:math:`
k-epsi
lon`</td>
<td>WRF
<span class="math">\(T_2\)</span></td>
<td><span class="math">\(U,V\)</span>
:
40-200 m;
<span class="math">\(\tau
_{nud}\)</span>
= 10 min</td>
<td>6</td>
</tr>
</tbody>
</table>
<p>Remarks: - All surface boundary conditions use Monin-Obukhov similarity
theory (MOST) - All use the same WRF tendencies, adding nudging or
modified tendencies as indicated - Details about the CFDWind1D model
settings and nudging methodology can be found in [2] - All the
simulations are run on a 4-km long log-linear grid with 301 levels and a
time step of 1 s - The <span class="math">\(k-\epsilon\)</span> model of Sogachev et a. (2012)
[3] is used as a reference, with the following set of constants:
<span class="math">\(\kappa\)</span> = 0.4, <span class="math">\(C_{\epsilon1}\)</span> = 1.52,
<span class="math">\(C_{\epsilon2}\)</span> = 1.833, <span class="math">\(\sigma_k\)</span> = 2.95,
<span class="math">\(\sigma_{\epsilon}\)</span> = 2.95 and <span class="math">\(C_\mu\)</span> = 0.03</p>
</div>
<div class="section" id="Load-libraries-and-define-input-data">
<h2>Load libraries and define input data<a class="headerlink" href="#Load-libraries-and-define-input-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [3]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">matplotlib.dates</span> <span class="kn">as</span> <span class="nn">mdates</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">spatial</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">netCDF4</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="kn">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">interpolate</span>
<span class="kn">import</span> <span class="nn">scipy.integrate</span> <span class="kn">as</span> <span class="nn">integrate</span>
<span class="kn">import</span> <span class="nn">statsmodels.api</span> <span class="kn">as</span> <span class="nn">sm</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Constants</span>
<span class="n">K</span>       <span class="o">=</span> <span class="mf">0.41</span>            <span class="c1"># von Karman constant</span>
<span class="n">g</span>       <span class="o">=</span> <span class="mf">9.81</span>            <span class="c1"># [m s-2]</span>
<span class="n">R_air</span>   <span class="o">=</span> <span class="mf">287.058</span>         <span class="c1"># Specific gas constant for dry air [J kg-1 K-1]</span>
<span class="n">Cp_air</span>  <span class="o">=</span> <span class="mi">1005</span>            <span class="c1"># Specific heat of air [J kg-1 K-1]</span>
<span class="n">P0</span>      <span class="o">=</span> <span class="mf">100000.</span>         <span class="c1"># Reference pressure [Pa]</span>

<span class="c1"># Site ID</span>
<span class="n">siteID</span> <span class="o">=</span> <span class="s1">&#39;GABLS3&#39;</span>
<span class="n">lat_s</span> <span class="o">=</span> <span class="mf">51.971</span>   <span class="c1"># degrees N</span>
<span class="n">lon_s</span> <span class="o">=</span> <span class="mf">4.927</span>    <span class="c1"># degrees E</span>

<span class="c1"># Evaluation Period and reference Rotor chararcteristics</span>
<span class="n">datefrom</span>  <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># Origin of evaluation period</span>
<span class="n">dateto</span>    <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span><span class="p">)</span>       <span class="c1"># End of evaluation period</span>
<span class="n">Hhub</span> <span class="o">=</span> <span class="mf">120.</span>         <span class="c1"># hub-height</span>
<span class="n">Drot</span> <span class="o">=</span> <span class="mf">160.</span>         <span class="c1"># rotor diameter</span>
<span class="n">ts</span> <span class="o">=</span> <span class="mi">10</span>             <span class="c1"># sampling frequency to evaluate [min]</span>

<span class="c1"># Mesoscale tendencies averaging settings</span>
<span class="n">tav</span> <span class="o">=</span> <span class="mf">60.0</span>          <span class="c1"># Time averaging time used in simulations [min]</span>
<span class="n">Lav</span> <span class="o">=</span> <span class="mf">9000.0</span>        <span class="c1"># Spatial averaging [m]</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-Simulation-data">
<h2>Load Simulation data<a class="headerlink" href="#Load-Simulation-data" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [20]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="n">dirsim</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
<span class="n">filesim</span> <span class="o">=</span> <span class="p">[</span><span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_tendencies_d02_YSU_w60_L9000.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_2.nc&#39;</span><span class="p">,</span>

           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb0_T2_9.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb1_T2_10.nc&#39;</span><span class="p">,</span>

           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2wt_6.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_Tsk_7.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2obs_11.nc&#39;</span><span class="p">,</span>

           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_noTadv_3.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_noTadvUadv_4.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_noTadvUadvSg0_5.nc&#39;</span><span class="p">,</span>

           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2obs_UVTnud2-80_12.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2obs_UVTnud2-120_13.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2obs_UVTnud2-200_20.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2obs_UVTnud2-200tau10_21.nc&#39;</span><span class="p">,</span>

           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_UVnud40-400_14.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_UVnud40-200_15.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_UVnud40-200tau30_16.nc&#39;</span><span class="p">,</span>
           <span class="n">dirsim</span> <span class="o">+</span> <span class="s1">&#39;/GABLS3_CFDWindSCM_turb5_T2_UVnud40-200tau10_17.nc&#39;</span><span class="p">,</span>
           <span class="p">]</span>


<span class="n">simID</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;WRF-YSU&#39;</span><span class="p">,</span><span class="s1">&#39;ke_T2&#39;</span><span class="p">,</span>
         <span class="s1">&#39;Sl_T2&#39;</span><span class="p">,</span><span class="s1">&#39;kl_T2&#39;</span><span class="p">,</span>
         <span class="s1">&#39;ke_T2wt&#39;</span><span class="p">,</span><span class="s1">&#39;ke_Tsk&#39;</span><span class="p">,</span><span class="s1">&#39;ke_T2obs&#39;</span><span class="p">,</span>
         <span class="s1">&#39;noTadv&#39;</span><span class="p">,</span><span class="s1">&#39;noTadvUadv&#39;</span><span class="p">,</span><span class="s1">&#39;noTadvUadv_Sg0&#39;</span><span class="p">,</span>
         <span class="s1">&#39;UVTnud80&#39;</span><span class="p">,</span><span class="s1">&#39;UVTnud120&#39;</span><span class="p">,</span><span class="s1">&#39;UVTnud200&#39;</span><span class="p">,</span><span class="s1">&#39;UVTnud200_tau10&#39;</span><span class="p">,</span>
         <span class="s1">&#39;UVnud400&#39;</span><span class="p">,</span><span class="s1">&#39;UVnud200&#39;</span><span class="p">,</span><span class="s1">&#39;UVnud200_tau30&#39;</span><span class="p">,</span><span class="s1">&#39;UVnud200_tau10&#39;</span><span class="p">]</span>

<span class="n">simtype</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;meso&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span>
           <span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">,</span><span class="s1">&#39;micro&#39;</span><span class="p">]</span>

<span class="n">Nsim</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">filesim</span><span class="p">)</span>

<span class="c1"># Create a list with the simulation datasets</span>
<span class="n">t</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">U</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">V</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Th</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">z</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">S</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">WD</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">TKE</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">us</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">wt</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">T2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">L</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Psfc</span> <span class="o">=</span> <span class="p">[]</span>

<span class="n">zflux</span> <span class="o">=</span> <span class="mf">3.0</span>     <span class="c1"># height to extract surface values from microscale simulation</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">f</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">filesim</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
    <span class="n">times</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>
    <span class="n">idates</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">times</span> <span class="o">&gt;=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">times</span> <span class="o">&lt;</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)))[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">t</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">U</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;U&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">V</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;V&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">Th</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Th&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="n">z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][:])</span>
    <span class="n">S</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">V</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span><span class="p">)</span>
    <span class="n">WD</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="mi">180</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">V</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span><span class="o">*</span><span class="mi">180</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">simtype</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span> <span class="o">==</span> <span class="s1">&#39;micro&#39;</span><span class="p">:</span>
        <span class="n">zf</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;z&#39;</span><span class="p">][:]</span>
        <span class="n">izflux</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zf</span><span class="o">-</span><span class="n">zflux</span><span class="p">)</span> <span class="o">==</span> <span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">zf</span><span class="o">-</span><span class="n">zflux</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">iz2</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">-</span><span class="mf">2.</span><span class="p">)</span><span class="o">==</span><span class="nb">min</span><span class="p">(</span><span class="nb">abs</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">-</span><span class="mf">2.</span><span class="p">)))[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">])</span>
        <span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ust&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,</span><span class="n">izflux</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,</span><span class="n">izflux</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">wt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,</span><span class="n">izflux</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">T2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Th&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,</span><span class="n">iz2</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">Psfc</span><span class="o">.</span><span class="n">append</span><span class="p">([])</span>
        <span class="n">TKE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;TKE&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">,:],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">us</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ust&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">L</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;L&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">wt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">T2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;T2&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">Psfc</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;Psfc&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">],</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][</span><span class="n">idates</span><span class="p">]))</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">())</span>
        <span class="n">TKE</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="p">))</span>
    <span class="n">f</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

</pre></div>
</div>
</div>
</div>
<div class="section" id="Load-Observations">
<h2>Load Observations<a class="headerlink" href="#Load-Observations" title="Permalink to this headline">¶</a></h2>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [21]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Note that the file &#39;gabls3_scm_cabauw_obs_v33.nc&#39; can be obtained from the KNMI GABLS3 website</span>
<span class="c1"># http://projects.knmi.nl/gabls/gabls3_scm_cabauw_obs_v33.nc</span>
<span class="c1"># Alternatively, it is also provided in the Windbench/GABLS3 input dataset</span>

<span class="n">dirobs</span> <span class="o">=</span> <span class="s1">&#39;.&#39;</span>
<span class="n">fileobs</span> <span class="o">=</span> <span class="n">dirobs</span> <span class="o">+</span> <span class="s1">&#39;/gabls3_scm_cabauw_obs_v33.nc&#39;</span>
<span class="n">nodata</span> <span class="o">=</span> <span class="o">-</span><span class="mf">9999.0</span>                          <span class="c1"># missing data flag</span>
<span class="n">date0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span> <span class="c1"># origin of time_obs</span>

<span class="n">f1</span> <span class="o">=</span> <span class="n">netCDF4</span><span class="o">.</span><span class="n">Dataset</span><span class="p">(</span><span class="n">fileobs</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span>
<span class="n">dates_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;date&#39;</span><span class="p">][:]</span>
<span class="n">time_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;time&#39;</span><span class="p">][:]</span>   <span class="c1"># &#39;hours since 2006-07-01 00:00:00 0:00&#39;</span>

<span class="n">date_obs</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">time_obs</span><span class="p">)):</span>
    <span class="n">date_obs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">date0</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">seconds</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">int</span><span class="p">(</span><span class="n">time_obs</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="o">*</span><span class="mf">3600.0</span><span class="p">)))</span>

<span class="n">ifrom_obs</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">date_obs</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">date_obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">datefrom</span><span class="p">:</span>
        <span class="n">ifrom_obs</span> <span class="o">=</span> <span class="n">j</span>
<span class="n">ito_obs</span><span class="o">=</span><span class="mi">0</span>
<span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">date_obs</span><span class="p">)):</span>
    <span class="k">if</span> <span class="n">date_obs</span><span class="p">[</span><span class="n">j</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">dateto</span><span class="p">:</span>
        <span class="n">ito_obs</span> <span class="o">=</span> <span class="n">j</span><span class="o">+</span><span class="mi">1</span>

<span class="n">date_obs</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">])</span>
<span class="n">time_obs</span> <span class="o">=</span> <span class="mf">24.0</span><span class="o">*</span><span class="p">(</span><span class="n">date_obs</span> <span class="o">-</span> <span class="n">date_obs</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1"># Surface variables</span>
<span class="n">ustar_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ustar&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ustar&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">U10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">V10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">S10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">WD10_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d10m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">T2_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;t2m&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">HFX_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;shf&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;shf&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">Ts_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;ts&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">zs_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zs&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># soil temperature heights [m]</span>
<span class="n">Tsk_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">Tsk1_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk1&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;tsk1&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>

<span class="c1"># Vertical profiles</span>
<span class="n">zf_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zf&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># velocity profile heights [m]</span>
<span class="n">zT_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zt&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># temperature profile heights [m]</span>
<span class="n">U_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;u&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">V_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;v&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">S_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;f&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>  <span class="c1"># horizontal wind speed [deg]</span>
<span class="n">WD_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;d&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span> <span class="c1"># wind direction [deg]</span>
<span class="n">Th_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;th&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>   <span class="c1"># potential temperature [K]</span>
<span class="n">q_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;q&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>

<span class="c1"># fluxes</span>
<span class="n">zh_obs</span> <span class="o">=</span> <span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;zh&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">][</span><span class="mi">0</span><span class="p">,:]</span>   <span class="c1"># fluxes heights</span>
<span class="n">wt_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;wt&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">uw_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;uw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;uw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">vw_obs</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ma</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">],</span> <span class="n">mask</span><span class="o">=</span><span class="p">(</span><span class="n">f1</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s1">&#39;vw&#39;</span><span class="p">][</span><span class="n">ifrom_obs</span><span class="p">:</span><span class="n">ito_obs</span><span class="p">]</span> <span class="o">==</span> <span class="n">nodata</span><span class="p">)),</span> <span class="n">index</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">num2date</span><span class="p">(</span><span class="n">date_obs</span><span class="p">))</span>
<span class="n">us_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">uw_obs</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">vw_obs</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.25</span>

<span class="c1"># Obukhov length</span>
<span class="n">T0_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">Th_obs</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,(</span><span class="mi">5</span><span class="p">,</span><span class="mi">1</span><span class="p">))</span><span class="o">.</span><span class="n">T</span>
<span class="n">L_obs</span> <span class="o">=</span> <span class="o">-</span><span class="n">us_obs</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">K</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">/</span><span class="n">T0_obs</span><span class="p">)</span><span class="o">*</span><span class="n">wt_obs</span><span class="p">)</span>

<span class="c1"># Resample and apply tav to observations</span>
<span class="n">ws</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">tav</span><span class="o">/</span><span class="n">ts</span><span class="p">)</span>  <span class="c1"># rolling window size</span>
<span class="n">ustar_obs_w</span> <span class="o">=</span> <span class="n">ustar_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">HFX_obs_w</span> <span class="o">=</span> <span class="n">HFX_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">U10_obs_w</span> <span class="o">=</span> <span class="n">U10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">V10_obs_w</span> <span class="o">=</span> <span class="n">V10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">S10_obs_w</span> <span class="o">=</span> <span class="n">S10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">WD10_obs_w</span> <span class="o">=</span> <span class="n">WD10_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">T2_obs_w</span> <span class="o">=</span> <span class="n">T2_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Ts_obs_w</span> <span class="o">=</span> <span class="n">Ts_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">U_obs_w</span> <span class="o">=</span> <span class="n">U_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">V_obs_w</span> <span class="o">=</span> <span class="n">V_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">S_obs_w</span> <span class="o">=</span> <span class="n">S_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">WD_obs_w</span> <span class="o">=</span> <span class="n">WD_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">Th_obs_w</span> <span class="o">=</span> <span class="n">Th_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">q_obs_w</span> <span class="o">=</span> <span class="n">q_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">wt_obs_w</span> <span class="o">=</span> <span class="n">wt_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">uw_obs_w</span> <span class="o">=</span> <span class="n">uw_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">vw_obs_w</span> <span class="o">=</span> <span class="n">vw_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">us_obs_w</span> <span class="o">=</span> <span class="n">us_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">L_obs_w</span> <span class="o">=</span> <span class="n">L_obs</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;Min&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">bfill</span><span class="p">()</span><span class="o">.</span><span class="n">rolling</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="n">ws</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<span class="n">TKE_obs_w</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">U_obs_w</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span><span class="n">index</span><span class="o">=</span><span class="n">U_obs_w</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>

<span class="k">if</span> <span class="n">zflux</span> <span class="o">==</span> <span class="mf">3.0</span><span class="p">:</span>
    <span class="n">ust0_obs_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">ustar_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">Psfc_obs</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">interp</span><span class="p">(</span><span class="n">time_obs</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Psfc</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">T0_obs_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">Th_obs_w</span><span class="p">[</span><span class="mi">36</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
    <span class="n">rho_obs_w</span> <span class="o">=</span> <span class="n">Psfc_obs</span><span class="o">/</span><span class="p">(</span><span class="n">R_air</span><span class="o">*</span><span class="n">T0_obs_w</span><span class="p">)</span>
    <span class="n">wt0_obs_w</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">HFX_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">rho_obs_w</span><span class="o">*</span><span class="n">Cp_air</span><span class="p">)</span>
    <span class="n">L0_obs_w</span> <span class="o">=</span> <span class="o">-</span><span class="n">ust0_obs_w</span><span class="o">**</span><span class="mi">3</span><span class="o">/</span><span class="p">(</span><span class="n">K</span><span class="o">*</span><span class="p">(</span><span class="n">g</span><span class="o">/</span><span class="n">T0_obs_w</span><span class="p">)</span><span class="o">*</span><span class="n">wt0_obs_w</span><span class="p">)</span>
<span class="k">else</span><span class="p">:</span>
    <span class="n">izh</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">zh_obs</span> <span class="o">==</span> <span class="n">zflux</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">ust0_obs_w</span> <span class="o">=</span> <span class="n">us_obs_w</span><span class="p">[</span><span class="n">izh</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">wt0_obs_w</span> <span class="o">=</span> <span class="n">wt_obs_w</span><span class="p">[</span><span class="n">izh</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">L0_obs_w</span> <span class="o">=</span> <span class="n">L_obs_w</span><span class="p">[</span><span class="n">izh</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="Plot-tz-contours">
<h2>Plot tz contours<a class="headerlink" href="#Plot-tz-contours" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [19]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># List simulations for index reference</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">simID</span><span class="p">)):</span>
    <span class="k">print</span> <span class="n">isim</span><span class="p">,</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
0 WRF-YSU
1 ke_T2
2 Sl_T2
3 kl_T2
4 ke_T2wt
5 ke_Tsk
6 ke_T2obs
7 noTadv
8 noTadvUadv
9 noTadvUadv_Sg0
10 UVTnud80
11 UVTnud120
12 UVTnud200
13 UVTnud200_tau10
14 UVnud400
15 UVnud200
16 UVnud200_tau30
17 UVnud200_tau10
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [30]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Select the simulations you want to plot</span>
<span class="n">plotsim</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">8</span><span class="p">,</span><span class="mi">9</span><span class="p">,</span><span class="mi">13</span><span class="p">,</span><span class="mi">17</span><span class="p">])</span>

<span class="c1"># Plot settings</span>
<span class="n">zlim</span> <span class="o">=</span> <span class="mi">2000</span>                                   <span class="c1"># height limit [m]</span>
<span class="n">Zcmap</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">get_cmap</span><span class="p">(</span><span class="s1">&#39;jet&#39;</span><span class="p">)</span>                   <span class="c1"># colormap</span>
<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_tzfields.png&#39;</span>              <span class="c1"># output filename</span>
<span class="n">Zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">16</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span>     <span class="c1"># range for S</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span><span class="mi">210</span><span class="p">,</span><span class="mi">13</span><span class="p">),</span>   <span class="c1"># range for WD</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">285</span><span class="p">,</span><span class="mi">305</span><span class="p">,</span><span class="mi">11</span><span class="p">),</span>  <span class="c1"># range for Th</span>
                    <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">11</span><span class="p">)])</span>     <span class="c1"># range for TKE</span>

<span class="n">X</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Y</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Z</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">taxis</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">zaxis</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Ztitle</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">Z</span> <span class="o">=</span> <span class="p">[</span><span class="n">S_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">WD_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">Th_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">,</span> <span class="n">TKE_obs_w</span><span class="o">.</span><span class="n">T</span><span class="p">]</span>
<span class="p">[</span><span class="n">Xf</span><span class="p">,</span><span class="n">Yf</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">date_obs</span><span class="p">,</span><span class="n">zf_obs</span><span class="p">)</span>
<span class="p">[</span><span class="n">XT</span><span class="p">,</span><span class="n">YT</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">date_obs</span><span class="p">,</span><span class="n">zT_obs</span><span class="p">)</span>
<span class="n">X</span> <span class="o">=</span> <span class="p">[</span><span class="n">Xf</span><span class="p">,</span> <span class="n">Xf</span><span class="p">,</span> <span class="n">XT</span><span class="p">,</span> <span class="n">Xf</span><span class="p">]</span>
<span class="n">Y</span> <span class="o">=</span> <span class="p">[</span><span class="n">Yf</span><span class="p">,</span> <span class="n">Yf</span><span class="p">,</span> <span class="n">YT</span><span class="p">,</span> <span class="n">Yf</span><span class="p">]</span>
<span class="n">taxis</span> <span class="o">=</span> <span class="p">[</span><span class="n">date_obs</span><span class="p">,</span> <span class="n">date_obs</span><span class="p">,</span> <span class="n">date_obs</span><span class="p">,</span> <span class="n">date_obs</span><span class="p">]</span>
<span class="n">zaxis</span> <span class="o">=</span> <span class="p">[</span><span class="n">zf_obs</span><span class="p">,</span> <span class="n">zf_obs</span><span class="p">,</span> <span class="n">zT_obs</span><span class="p">,</span> <span class="n">zf_obs</span><span class="p">]</span>
<span class="n">Ztitle</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Observations&#39;</span><span class="p">]</span>
<span class="k">for</span> <span class="n">ip</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">ip</span><span class="p">]</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">S</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WD</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Th</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Z</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">TKE</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
    <span class="p">[</span><span class="n">X0</span><span class="p">,</span><span class="n">Y0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">meshgrid</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
    <span class="n">taxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">zaxis</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]);</span> <span class="n">X</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">X0</span><span class="p">);</span> <span class="n">Y</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Y0</span><span class="p">)</span>
    <span class="n">Ztitle</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>

<span class="n">Zlabel</span> <span class="o">=</span> <span class="p">(</span><span class="s1">&#39;$S$ [$m s^{-1}$]&#39;</span><span class="p">,</span><span class="s1">&#39;$WD$ [&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">,</span><span class="s1">&#39;$\Theta$ [$K$]&#39;</span><span class="p">,</span><span class="s1">&#39;$TKE$ [$m^{2} s^{-2}$]&#39;</span><span class="p">)</span>
<span class="n">taxis_label</span> <span class="o">=</span> <span class="s1">&#39;UTC time in hours since &#39;</span> <span class="o">+</span> <span class="n">datefrom</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, $L_{avg}$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Lav</span><span class="o">/</span><span class="mi">1000</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; km, $t_{avg}$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">tav</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; min&#39;</span>
<span class="n">zaxis_label</span> <span class="o">=</span> <span class="s1">&#39;$z$ [$m$]&#39;</span>
<span class="n">hoursFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span>
<span class="n">Zlevels</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">Zlevels</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">))</span>

<span class="n">hoursFmt</span> <span class="o">=</span> <span class="n">mdates</span><span class="o">.</span><span class="n">DateFormatter</span><span class="p">(</span><span class="s1">&#39;%H&#39;</span><span class="p">)</span>
<span class="n">tticks</span> <span class="o">=</span> <span class="p">[</span><span class="n">datefrom</span> <span class="o">+</span> <span class="n">datetime</span><span class="o">.</span><span class="n">timedelta</span><span class="p">(</span><span class="n">hours</span> <span class="o">=</span> <span class="mi">3</span><span class="o">*</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">9</span><span class="p">)]</span>

<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">),</span> <span class="mi">4</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">11</span><span class="p">,</span><span class="mi">17</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">xrotor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>
<span class="n">yrotor1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Hhub</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="n">Hhub</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">])</span>
<span class="n">yrotor2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="n">Hhub</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="n">Hhub</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">])</span>
<span class="n">cbleft</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">0.125</span><span class="p">,</span><span class="mf">0.33</span><span class="p">,</span><span class="mf">0.53</span><span class="p">,</span><span class="mf">0.73</span><span class="p">])</span>
<span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">)</span><span class="o">*</span><span class="mi">4</span><span class="p">):</span>
    <span class="n">ix</span><span class="p">,</span><span class="n">iy</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">unravel_index</span><span class="p">(</span><span class="n">iax</span><span class="p">,(</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">),</span><span class="mi">4</span><span class="p">))</span>
    <span class="n">CF0</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">contourf</span><span class="p">(</span><span class="n">X</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span><span class="n">Y</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span><span class="n">Z</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="n">Zlevels</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="n">cmap</span><span class="o">=</span><span class="n">Zcmap</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xrotor</span><span class="p">,</span><span class="n">yrotor1</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xrotor</span><span class="p">,</span><span class="n">yrotor2</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mi">10</span><span class="p">,</span> <span class="n">zlim</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_yscale</span><span class="p">(</span><span class="s1">&#39;log&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iy</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">zaxis_label</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">iy</span> <span class="o">==</span> <span class="mi">3</span><span class="p">:</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">set_label_position</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span>
        <span class="n">ax</span><span class="p">[</span><span class="n">ix</span><span class="p">,</span><span class="n">iy</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">[</span><span class="n">ix</span><span class="p">],</span> <span class="n">fontsize</span> <span class="o">=</span> <span class="mi">9</span><span class="p">,</span> <span class="n">fontweight</span><span class="o">=</span><span class="s1">&#39;bold&#39;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">ix</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="mf">0.87</span><span class="p">)</span>
        <span class="n">cbar_ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_axes</span><span class="p">([</span><span class="n">cbleft</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span><span class="mf">0.885</span><span class="p">,</span> <span class="mf">0.165</span><span class="p">,</span> <span class="mf">0.012</span><span class="p">])</span>
        <span class="n">cbar</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">CF0</span><span class="p">,</span> <span class="n">cax</span><span class="o">=</span><span class="n">cbar_ax</span><span class="p">,</span> <span class="n">orientation</span><span class="o">=</span><span class="s1">&#39;horizontal&#39;</span><span class="p">)</span>
        <span class="n">cbar</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">Zlabel</span><span class="p">[</span><span class="n">iy</span><span class="p">],</span><span class="n">labelpad</span> <span class="o">=</span> <span class="o">-</span><span class="mi">42</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="nb">len</span><span class="p">(</span><span class="n">Ztitle</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">taxis_label</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="mf">1.2</span><span class="p">);</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_xticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="p">:]],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">]],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, dpi = 300)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">Markdown</span><span class="p">,</span> <span class="n">display</span>
<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 1. Time-height contour of horizontal wind speed $S$, direction $WD$, &quot;</span>
         <span class="s2">&quot;potential temperature $\Theta$ and turbulent kinetic energy $TKE$. Dotted lines &quot;</span>
         <span class="s2">&quot;denote a rotor diameter of 160 m at 120 m hub-height.**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_10_0.png" src="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_10_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 1. Time-height contour of horizontal wind speed :math:`S`,
direction :math:`WD`, potential temperature :math:`Theta` and turbulent
kinetic energy :math:`TKE`. Dotted lines denote a rotor diameter of 160
m at 120 m hub-height.</strong></div>
</div>
</div>
<div class="section" id="Vertical-Profiles">
<h2>Vertical Profiles<a class="headerlink" href="#Vertical-Profiles" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [31]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Specify the datetime at which you want to plot the vertical profiles</span>
<span class="n">t0</span> <span class="o">=</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="p">(</span><span class="mi">2006</span><span class="p">,</span><span class="mi">7</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>

<span class="c1"># Plot settings</span>
<span class="n">linespec</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;k-&#39;</span><span class="p">,</span><span class="s1">&#39;b.-&#39;</span><span class="p">,</span><span class="s1">&#39;r.-&#39;</span><span class="p">,</span><span class="s1">&#39;c.-&#39;</span><span class="p">,</span><span class="s1">&#39;m-&#39;</span><span class="p">,</span><span class="s1">&#39;g-&#39;</span><span class="p">,</span><span class="s1">&#39;y-&#39;</span><span class="p">,</span><span class="s1">&#39;c-&#39;</span><span class="p">,</span><span class="s1">&#39;b-.&#39;</span><span class="p">,</span><span class="s1">&#39;r--&#39;</span><span class="p">]</span>
<span class="n">lwidth</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">2</span><span class="p">])</span>
<span class="n">Nm</span> <span class="o">=</span> <span class="mi">3</span>  <span class="c1"># marker every</span>

<span class="n">Z_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">S_obs_w</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">WD_obs_w</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
         <span class="n">Th_obs_w</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)</span>
<span class="n">z_obs</span> <span class="o">=</span> <span class="p">(</span><span class="n">zf_obs</span><span class="p">,</span> <span class="n">zf_obs</span><span class="p">,</span> <span class="n">zT_obs</span><span class="p">)</span>

<span class="n">Z_sim</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">z_sim</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">Z_sim</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">S</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span> <span class="n">WD</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">,</span>
                  <span class="n">Th</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">t0</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">z_sim</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">]))</span>

<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_&#39;</span><span class="o">+</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1">_%H&#39;</span><span class="p">)</span><span class="o">+</span><span class="s1">&#39;_profiles.png&#39;</span>

<span class="n">zlim</span> <span class="o">=</span> <span class="mi">1000</span>
<span class="n">fig</span><span class="p">,</span><span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">3</span><span class="p">,</span> <span class="n">sharey</span><span class="o">=</span><span class="s1">&#39;row&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">8</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>
<span class="k">for</span> <span class="n">iax</span> <span class="ow">in</span> <span class="nb">range</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="mi">3</span><span class="p">):</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Z_obs</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="n">z_obs</span><span class="p">[</span><span class="n">iax</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
        <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">isim</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="n">iax</span> <span class="o">==</span> <span class="mi">2</span><span class="p">):</span>
            <span class="n">aa</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">Z_sim</span><span class="p">[</span><span class="n">iplot</span><span class="p">][</span><span class="n">iax</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span> <span class="n">z_sim</span><span class="p">[</span><span class="n">iplot</span><span class="p">][</span><span class="n">iax</span><span class="p">][</span><span class="mi">1</span><span class="p">:],</span>
                <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span> <span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span> <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
        <span class="c1">#ax[iax].set_yscale(&#39;log&#39;)</span>
    <span class="n">xlim</span> <span class="o">=</span> <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">get_xlim</span><span class="p">()</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span><span class="n">yrotor1</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">xlim</span><span class="p">,</span><span class="n">yrotor2</span><span class="p">,</span><span class="s1">&#39;--k&#39;</span><span class="p">)</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="n">zlim</span><span class="p">])</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">set_yticks</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">zlim</span><span class="p">,</span><span class="mi">5</span><span class="p">))</span>
    <span class="n">ax</span><span class="p">[</span><span class="n">iax</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="c1">#ax[0].set_xlim([0, 16])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">60</span><span class="p">,</span> <span class="mi">180</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="mi">285</span><span class="p">,</span> <span class="mi">300</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$S$ [$m s^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;$WD$ [&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$\Theta$ [$K$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;$z$ [$m$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;$t_{0}$ = &#39;</span><span class="o">+</span> <span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">10</span><span class="p">},</span><span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper left&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">setp</span><span class="p">([</span><span class="n">a</span><span class="o">.</span><span class="n">get_yticklabels</span><span class="p">()</span> <span class="k">for</span> <span class="n">a</span> <span class="ow">in</span> <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">:]],</span> <span class="n">visible</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, format=&#39;png&#39;, dpi=300)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 2. Vertical profiles of wind speed, wind direction &quot;</span>
         <span class="s2">&quot;and potential temperature at UTC **&quot;</span><span class="o">+</span><span class="n">t0</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M:%S&#39;</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_12_0.png" src="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_12_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 2. Vertical profiles of wind speed, wind direction and potential
temperature at UTC</strong>2006-07-02 00:00:00</div>
</div>
</div>
<div class="section" id="Surface-Fluxes">
<h2>Surface Fluxes<a class="headerlink" href="#Surface-Fluxes" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [42]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Surface fluxes</span>
<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_surfaceflux.png&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="p">(</span><span class="n">ax1</span><span class="p">,</span><span class="n">ax2</span><span class="p">,</span><span class="n">ax3</span><span class="p">,</span><span class="n">ax4</span><span class="p">)</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">8</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">ust0_obs_w</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax1</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">us</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$u_{*0}$ [$m s^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax1</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.35</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>

<span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">wt0_obs_w</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax2</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">wt</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$w\theta_0$ [$K m s^{-1}$]&#39;</span><span class="p">)</span>
<span class="c1">#ax2.yaxis.set_major_formatter(tick.FormatStrFormatter(&#39;%2.1e&#39;))</span>
<span class="n">ax2</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">zflux</span><span class="o">/</span><span class="n">L0_obs_w</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax3</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">zflux</span><span class="o">/</span><span class="n">L</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$z/L_0$ [-]&#39;</span><span class="p">)</span>
<span class="c1">#ax3.set_ylim([-1.5, 1.5])</span>
<span class="n">ax3</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>

<span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">Th_obs_w</span><span class="p">[</span><span class="mi">36</span><span class="p">][::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax4</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">T2</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">])</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$T_2$ [$K$]&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">taxis_label</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
<span class="n">ax4</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>

<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, dpi=300)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 3. Surface-layer characteristics**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_14_0.png" src="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_14_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 3. Surface-layer characteristics</strong></div>
</div>
</div>
<div class="section" id="Quantities-of-Interest-and-Metrics">
<h2>Quantities of Interest and Metrics<a class="headerlink" href="#Quantities-of-Interest-and-Metrics" title="Permalink to this headline">¶</a></h2>
<p>The performance of the models is based on quantities of interest
relevant for wind energy applications. These quantities are evaluated
across a reference rotor span of 160 m, between 40 and 200 m,
characteristic of an 8-MW large wind turbine. Besides hub-height wind
speed <span class="math">\(S_{hub}\)</span> and direction <span class="math">\(WD_{hub}\)</span>, it is relevant to
consider the rotor-equivalent wind speed <span class="math">\(REWS\)</span>, the turbulence
intensity (not evaluated here), the wind speed shear <span class="math">\(\alpha\)</span>, and
the wind direction shear or veer <span class="math">\(\psi\)</span>.</p>
<p>The REWS is especially suitable to account for wind shear in wind
turbine power performance tests [14]. The REWS is the wind speed
corresponding to the kinetic energy flux through the swept rotor area,
when accounting for the vertical shear:</p>
<div class="math">
\[REWS = \left[\frac{1}{A}\sum_{i}(A_iS_i^3\cos\beta_i)\right]^{1/3}\]</div>
<p>where <span class="math">\(A\)</span> is the rotor area and <span class="math">\(A_i\)</span> are the horizontal
segments that separate vertical measurement points of horizontal wind
speed <span class="math">\(S_i\)</span> across the rotor plane. The <span class="math">\(REWS\)</span> is here
weighted by the cosine of the angle <span class="math">\(\beta_i\)</span> of the wind
direction <span class="math">\(WD_i\)</span> with respect to the hub-height wind direction to
account for the effect of wind veer [15].</p>
<p>Wind shear is defined by fitting a power-law curve across the rotor wind
speed points <span class="math">\(S_i\)</span>:</p>
<div class="math">
\[S_i = S_{hub}\left(\frac{z_i}{z_{hub}}\right)^{\alpha}\]</div>
<p>Similarly, wind veer is defined as the slope <span class="math">\(\psi\)</span> of the linear
fit of the wind direction difference:</p>
<div class="math">
\[\beta_i = \psi(z_i-z_{hub})\]</div>
<p>To evaluate simulations and measurements consistently, these quantities
are obtained after resampling, by linear interpolation, velocity and
wind direction vertical profiles at 10 points across the rotor area and
then computing the REWS and the shear functional fits. While these
fitting functions are commonly used in wind energy, their suitability in
LLJ conditions is questionable. The regression coefficient from the
fitting can be used to determine this suitability.</p>
<p>A rolling average with a window size of one hour is applied to
simulation and observational data to remove the impact of high frequency
fluctuations in the analysis.</p>
<p>Validation results are quantified in terms of the mean absolute error
(<span class="math">\(MAE\)</span>):</p>
<div class="math">
\[MAE = \frac{1}{N}\sum_{i=1}^{N}\left|\chi_{pred}-\chi_{obs}\right|\]</div>
<p>where <span class="math">\(\chi\)</span> is any of the above mentioned quantities of interest,
predicted (<em>pred</em>) or observed (<em>obs</em>), and <span class="math">\(N\)</span> is the number of
samples evaluated in the time series.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [33]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Define rotor-based quantities of interest</span>
<span class="n">zrot</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">Hhub</span> <span class="o">-</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="n">Hhub</span> <span class="o">+</span> <span class="mf">0.5</span><span class="o">*</span><span class="n">Drot</span><span class="p">,</span> <span class="mi">1</span> <span class="o">+</span> <span class="n">Drot</span><span class="o">/</span><span class="mi">10</span><span class="p">,</span> <span class="n">endpoint</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rotor</span><span class="p">(</span><span class="n">z</span><span class="p">,</span><span class="n">Sz</span><span class="p">,</span><span class="n">WDz</span><span class="p">):</span>
    <span class="c1"># Rotor QoIs [m s-1]</span>
    <span class="c1"># z: heights [m] where the velocity and wind direction are known spanning the rotor diameter</span>
    <span class="c1"># Sz, WDz: Wind speed [m s-1] and direction [deg from N] at z levels [tdim,zdim]</span>
    <span class="c1"># Returns:</span>
    <span class="c1">#   REWS: rotor equivalent wind speed [m s-1]</span>
    <span class="c1">#   alpha: wind shear, power-law exponent from linear fit lg(U/Uhub) = alpha*log(z/zhub)</span>
    <span class="c1">#   alpha_R2: R-squared from least squares fit to linear function</span>
    <span class="c1">#   veer: wind veer, slope of linear function beta = WDz - WDhub = veer*(z - zhub)</span>
    <span class="c1">#   veer_R2: R-squared from least squares fit to linear function</span>
    <span class="n">tdim</span> <span class="o">=</span> <span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
    <span class="n">zdim</span> <span class="o">=</span> <span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
    <span class="n">Rrot</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">-</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">Hhub</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">z</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
    <span class="n">ihub</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="mf">0.5</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">zrot</span><span class="p">))</span>
    <span class="n">Arotor</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="p">(</span><span class="n">Rrot</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span>
    <span class="n">Uz</span> <span class="o">=</span> <span class="o">-</span><span class="n">Sz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">WDz</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
    <span class="n">Vz</span> <span class="o">=</span> <span class="o">-</span><span class="n">Sz</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">WDz</span><span class="o">/</span><span class="mf">180.</span><span class="p">)</span>
    <span class="n">Shub</span> <span class="o">=</span> <span class="n">Sz</span><span class="p">[:,</span><span class="n">ihub</span><span class="p">]</span>
    <span class="n">WDhub</span> <span class="o">=</span> <span class="n">WDz</span><span class="p">[:,</span><span class="n">ihub</span><span class="p">]</span>
    <span class="k">def</span> <span class="nf">cz</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">R</span><span class="p">,</span><span class="n">H</span><span class="p">):</span>
        <span class="k">return</span> <span class="mf">2.</span><span class="o">*</span><span class="p">(</span><span class="n">R</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">H</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">0.5</span>
    <span class="n">sumA</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="n">veer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Sz</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>
    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">zdim</span><span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">Ai</span> <span class="o">=</span> <span class="n">integrate</span><span class="o">.</span><span class="n">quad</span><span class="p">(</span><span class="n">cz</span><span class="p">,</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">z</span><span class="p">[</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">args</span> <span class="o">=</span> <span class="p">(</span><span class="n">Rrot</span><span class="p">,</span><span class="n">Hhub</span><span class="p">))</span>
        <span class="n">Si</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Sz</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Sz</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">Ui</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Uz</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Uz</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">Vi</span> <span class="o">=</span> <span class="mf">0.5</span><span class="o">*</span><span class="p">(</span><span class="n">Vz</span><span class="p">[:,</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">]</span><span class="o">+</span><span class="n">Vz</span><span class="p">[:,</span><span class="n">i</span><span class="p">])</span>
        <span class="n">WDi</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Ui</span><span class="p">,</span><span class="n">Vi</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
        <span class="n">betai</span> <span class="o">=</span> <span class="n">WDi</span> <span class="o">-</span> <span class="n">WDhub</span>
        <span class="n">sumA</span> <span class="o">=</span> <span class="n">sumA</span> <span class="o">+</span> <span class="n">Ai</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">*</span><span class="p">(</span><span class="n">Si</span><span class="o">*</span><span class="n">np</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span><span class="o">*</span><span class="n">betai</span><span class="o">/</span><span class="mf">180.</span><span class="p">))</span><span class="o">**</span><span class="mi">3</span>

    <span class="n">REWS</span> <span class="o">=</span> <span class="p">(</span><span class="n">sumA</span><span class="o">/</span><span class="n">Arotor</span><span class="p">)</span><span class="o">**</span><span class="p">(</span><span class="mf">1.</span><span class="o">/</span><span class="mf">3.</span><span class="p">)</span>

    <span class="n">alpha</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span>    <span class="n">alpha_stderr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span> <span class="n">alpha_R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">)</span>
    <span class="n">veer</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span>     <span class="n">veer_stderr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">);</span> <span class="n">veer_R2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">tdim</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">it</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">tdim</span><span class="p">):</span>
        <span class="n">regmodel</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">Sz</span><span class="p">[</span><span class="n">it</span><span class="p">,:]</span><span class="o">/</span><span class="n">Shub</span><span class="p">[</span><span class="n">it</span><span class="p">]),</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">z</span><span class="o">/</span><span class="n">Hhub</span><span class="p">))</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">regmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">alpha</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">alpha_stderr</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">alpha_R2</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>
        <span class="n">regmodel</span> <span class="o">=</span> <span class="n">sm</span><span class="o">.</span><span class="n">OLS</span><span class="p">(</span><span class="n">WDz</span><span class="p">[</span><span class="n">it</span><span class="p">,:]</span> <span class="o">-</span> <span class="n">WDhub</span><span class="p">[</span><span class="n">it</span><span class="p">],</span> <span class="n">z</span> <span class="o">-</span> <span class="n">Hhub</span><span class="p">)</span>
        <span class="n">results</span> <span class="o">=</span> <span class="n">regmodel</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
        <span class="n">veer</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">params</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">veer_stderr</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">bse</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">veer_R2</span><span class="p">[</span><span class="n">it</span><span class="p">]</span> <span class="o">=</span> <span class="n">results</span><span class="o">.</span><span class="n">rsquared</span>

    <span class="k">return</span> <span class="n">REWS</span><span class="p">,</span> <span class="n">Shub</span><span class="p">,</span> <span class="n">WDhub</span><span class="p">,</span> <span class="n">alpha</span><span class="p">,</span> <span class="n">alpha_R2</span><span class="p">,</span> <span class="n">veer</span><span class="p">,</span> <span class="n">veer_R2</span>

<span class="n">Srews_obs</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">zf_obs</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">],</span><span class="n">date_obs</span><span class="p">,</span><span class="n">S_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">])(</span><span class="n">zrot</span><span class="p">,</span><span class="n">date_obs</span><span class="p">)</span>
<span class="n">Urews_obs</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">zf_obs</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">],</span><span class="n">date_obs</span><span class="p">,</span><span class="n">U_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">])(</span><span class="n">zrot</span><span class="p">,</span><span class="n">date_obs</span><span class="p">)</span>
<span class="n">Vrews_obs</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">zf_obs</span><span class="p">[</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">],</span><span class="n">date_obs</span><span class="p">,</span><span class="n">V_obs_w</span><span class="o">.</span><span class="n">values</span><span class="p">[:,</span><span class="mi">30</span><span class="p">:</span><span class="mi">34</span><span class="p">])(</span><span class="n">zrot</span><span class="p">,</span><span class="n">date_obs</span><span class="p">)</span>
<span class="n">WDrews_obs</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Urews_obs</span><span class="p">,</span><span class="n">Vrews_obs</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>

<span class="n">REWS_obs</span><span class="p">,</span> <span class="n">Shub_obs</span><span class="p">,</span> <span class="n">WDhub_obs</span><span class="p">,</span> <span class="n">alpha_obs</span><span class="p">,</span> <span class="n">alpha_R2_obs</span><span class="p">,</span> <span class="n">veer_obs</span><span class="p">,</span> <span class="n">veer_R2_obs</span> <span class="o">=</span> <span class="n">rotor</span><span class="p">(</span><span class="n">zrot</span><span class="p">,</span><span class="n">Srews_obs</span><span class="p">,</span><span class="n">WDrews_obs</span><span class="p">)</span>

<span class="n">REWS</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">Shub</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">WDhub</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">alpha</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">alpha_R2</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">veer</span> <span class="o">=</span> <span class="p">[];</span> <span class="n">veer_R2</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">Srews_sim</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">S</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)(</span><span class="n">zrot</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">Urews_sim</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">U</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)(</span><span class="n">zrot</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">Vrews_sim</span> <span class="o">=</span> <span class="n">interpolate</span><span class="o">.</span><span class="n">interp2d</span><span class="p">(</span><span class="n">z</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">),</span><span class="n">V</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">)(</span><span class="n">zrot</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">ravel</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">]</span><span class="o">.</span><span class="n">values</span><span class="p">))</span>
    <span class="n">WDrews_sim</span> <span class="o">=</span> <span class="mf">180.</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">arctan2</span><span class="p">(</span><span class="n">Urews_sim</span><span class="p">,</span><span class="n">Vrews_sim</span><span class="p">)</span><span class="o">*</span><span class="mf">180.</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">pi</span>
    <span class="n">REWS0</span><span class="p">,</span> <span class="n">Shub0</span><span class="p">,</span> <span class="n">WDhub0</span><span class="p">,</span> <span class="n">alpha0</span><span class="p">,</span> <span class="n">alpha_R20</span><span class="p">,</span> <span class="n">veer0</span><span class="p">,</span> <span class="n">veer_R20</span> <span class="o">=</span> <span class="n">rotor</span><span class="p">(</span><span class="n">zrot</span><span class="p">,</span><span class="n">Srews_sim</span><span class="p">,</span><span class="n">WDrews_sim</span><span class="p">)</span>

    <span class="n">REWS</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">REWS0</span><span class="p">)</span>
    <span class="n">Shub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">Shub0</span><span class="p">)</span>
    <span class="n">WDhub</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">WDhub0</span><span class="p">)</span>
    <span class="n">alpha</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha0</span><span class="p">)</span>
    <span class="n">alpha_R2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">alpha_R20</span><span class="p">)</span>
    <span class="n">veer</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">veer0</span><span class="p">)</span>
    <span class="n">veer_R2</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">veer_R20</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [43]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># plot QoIs</span>
<span class="n">figname</span> <span class="o">=</span> <span class="n">siteID</span><span class="o">+</span><span class="s1">&#39;_QoIs_rotor.png&#39;</span>

<span class="n">taxis_label</span> <span class="o">=</span> <span class="s1">&#39;UTC time in hours since &#39;</span> <span class="o">+</span> <span class="n">datefrom</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s1">&#39;%Y-%m-</span><span class="si">%d</span><span class="s1"> %H:%M&#39;</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;, $D$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Drot</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; m, $H$ = &#39;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="si">%.0f</span><span class="s2">&quot;</span><span class="o">%</span><span class="p">(</span><span class="n">Hhub</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39; m&#39;</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">sharex</span><span class="o">=</span><span class="s1">&#39;col&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">9</span><span class="p">,</span><span class="mi">6</span><span class="p">),</span> <span class="n">dpi</span><span class="o">=</span><span class="mi">300</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">REWS_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$REWS$ [$m s^{-1}$]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">2.</span><span class="p">,</span> <span class="mf">14.</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">WDhub_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;$WD_{hub}$ [&#39;</span><span class="o">+</span><span class="sa">u</span><span class="s1">&#39;</span><span class="se">\N{DEGREE SIGN}</span><span class="s1">&#39;</span><span class="o">+</span><span class="s1">&#39;]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="mf">60.</span><span class="p">,</span> <span class="mf">180.</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="n">taxis_label</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_label_coords</span><span class="p">(</span><span class="mf">1.2</span><span class="p">,</span> <span class="o">-</span><span class="mf">0.1</span><span class="p">)</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">alpha_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wind Shear $\alpha$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">date_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="n">veer_obs</span><span class="p">[::</span><span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;ok&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span> <span class="n">label</span> <span class="o">=</span> <span class="s1">&#39;obs &#39;</span><span class="p">)</span>
<span class="k">for</span> <span class="n">iplot</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">plotsim</span><span class="p">)):</span>
    <span class="n">isim</span> <span class="o">=</span> <span class="n">plotsim</span><span class="p">[</span><span class="n">iplot</span><span class="p">]</span>
    <span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">linespec</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span><span class="n">linewidth</span> <span class="o">=</span> <span class="n">lwidth</span><span class="p">[</span><span class="n">iplot</span><span class="p">],</span>
                        <span class="n">label</span> <span class="o">=</span> <span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span> <span class="n">markevery</span><span class="o">=</span><span class="n">Nm</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;Wind Veer $\psi$&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">grid</span><span class="p">(</span><span class="n">which</span><span class="o">=</span><span class="s1">&#39;major&#39;</span><span class="p">,</span><span class="n">color</span><span class="o">=</span><span class="s1">&#39;grey&#39;</span><span class="p">,</span><span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;:&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_ylim</span><span class="p">([</span><span class="o">-</span><span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.6</span><span class="p">])</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">set_major_formatter</span><span class="p">(</span><span class="n">hoursFmt</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">tticks</span><span class="p">)</span>
<span class="n">ax</span><span class="p">[</span><span class="mi">1</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_xlim</span><span class="p">([</span><span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">datefrom</span><span class="p">),</span> <span class="n">mdates</span><span class="o">.</span><span class="n">date2num</span><span class="p">(</span><span class="n">dateto</span><span class="p">)])</span>

<span class="n">ax</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">prop</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;size&#39;</span><span class="p">:</span><span class="mi">8</span><span class="p">},</span> <span class="n">bbox_to_anchor</span><span class="o">=</span><span class="p">(</span><span class="mf">1.5</span><span class="p">,</span> <span class="mi">1</span><span class="p">),</span> <span class="n">ncol</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">loc</span><span class="o">=</span><span class="s1">&#39;upper right&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">subplots_adjust</span><span class="p">(</span><span class="n">wspace</span><span class="o">=.</span><span class="mi">25</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1">#fig.savefig(figname, bbox_inches=&#39;tight&#39;, dpi = 300)</span>

<span class="n">figcaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Fig 4. Time series of rotor rotor-based quantities of interest used for validation**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">figcaption</span><span class="p">))</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_17_0.png" src="../../../../_images/windconditions_benchmarks_gabls_WES_paper_GABLS3_CFDWind1D_17_0.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Fig 4. Time series of rotor rotor-based quantities of interest used
for validation</strong></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [35]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">IPython.display</span> <span class="kn">import</span> <span class="n">display</span>
<span class="n">pd</span><span class="o">.</span><span class="n">options</span><span class="o">.</span><span class="n">display</span><span class="o">.</span><span class="n">float_format</span> <span class="o">=</span> <span class="s1">&#39;{:,.2f}&#39;</span><span class="o">.</span><span class="n">format</span>   <span class="c1"># format for output data in tables</span>

<span class="c1"># Compute error metics</span>
<span class="k">def</span> <span class="nf">mae</span><span class="p">(</span><span class="n">xtrue</span><span class="p">,</span> <span class="n">xpred</span><span class="p">,</span> <span class="n">norm</span><span class="p">):</span>
    <span class="c1"># Normalized Mean Absolute Error</span>
    <span class="c1"># xtrue: series with true values</span>
    <span class="c1"># xpred: series with predicted values</span>
    <span class="n">nonan</span> <span class="o">=</span> <span class="o">~</span><span class="n">np</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">xtrue</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">norm</span> <span class="o">==</span> <span class="s1">&#39;True&#39;</span><span class="p">:</span>
        <span class="n">xtrue0</span> <span class="o">=</span> <span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">])</span>
        <span class="n">xpred0</span> <span class="o">=</span> <span class="n">xpred</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span><span class="o">/</span><span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">])</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">xtrue0</span> <span class="o">=</span> <span class="n">xtrue</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span>
        <span class="n">xpred0</span> <span class="o">=</span> <span class="n">xpred</span><span class="p">[</span><span class="n">nonan</span><span class="p">]</span>

    <span class="n">N</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xtrue0</span><span class="p">)</span>
    <span class="n">abserr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">xpred0</span> <span class="o">-</span> <span class="n">xtrue0</span><span class="p">)</span>
    <span class="n">MAE</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">abserr</span><span class="p">)</span><span class="o">/</span><span class="n">N</span>
    <span class="k">return</span> <span class="n">MAE</span>

<span class="c1"># Errors with respecto to observations</span>
<span class="n">Metrics</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                       <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;REWS&#39;</span><span class="p">,</span><span class="s1">&#39;Shub&#39;</span><span class="p">,</span><span class="s1">&#39;WDhub&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;veer&#39;</span><span class="p">],</span>
                       <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">simID</span><span class="p">)</span>
<span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;REWS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">REWS_obs</span><span class="p">,</span><span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;Shub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">Shub_obs</span><span class="p">,</span><span class="n">Shub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;WDhub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">WDhub_obs</span><span class="p">,</span><span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">alpha_obs</span><span class="p">,</span><span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;veer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">veer_obs</span><span class="p">,</span><span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>

<span class="n">tablecaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Table 1. $MAE_{obs}$ with respect to observations**&quot;</span><span class="p">)</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">tablecaption</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Metrics</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Table 1. :math:`MAE_{obs}` with respect to observations</strong></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REWS</th>
      <th>Shub</th>
      <th>WDhub</th>
      <th>alpha</th>
      <th>veer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MAE</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>WRF-YSU</th>
      <td>1.37</td>
      <td>1.48</td>
      <td>11.59</td>
      <td>0.13</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>ke_T2</th>
      <td>1.42</td>
      <td>1.54</td>
      <td>12.72</td>
      <td>0.14</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>Sl_T2</th>
      <td>1.87</td>
      <td>1.85</td>
      <td>11.40</td>
      <td>0.19</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>kl_T2</th>
      <td>1.84</td>
      <td>1.81</td>
      <td>10.88</td>
      <td>0.19</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>ke_T2wt</th>
      <td>1.40</td>
      <td>1.49</td>
      <td>12.71</td>
      <td>0.13</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>ke_Tsk</th>
      <td>1.63</td>
      <td>1.91</td>
      <td>16.39</td>
      <td>0.15</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>ke_T2obs</th>
      <td>1.75</td>
      <td>1.77</td>
      <td>11.66</td>
      <td>0.12</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>noTadv</th>
      <td>1.44</td>
      <td>1.30</td>
      <td>13.77</td>
      <td>0.17</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>noTadvUadv</th>
      <td>1.76</td>
      <td>1.87</td>
      <td>11.78</td>
      <td>0.18</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>noTadvUadv_Sg0</th>
      <td>3.21</td>
      <td>3.20</td>
      <td>16.17</td>
      <td>0.29</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>UVTnud80</th>
      <td>1.42</td>
      <td>1.36</td>
      <td>10.33</td>
      <td>0.14</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>UVTnud120</th>
      <td>1.26</td>
      <td>1.17</td>
      <td>11.85</td>
      <td>0.14</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>UVTnud200</th>
      <td>0.71</td>
      <td>0.76</td>
      <td>9.36</td>
      <td>0.09</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>UVTnud200_tau10</th>
      <td>0.16</td>
      <td>0.19</td>
      <td>3.80</td>
      <td>0.05</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>UVnud400</th>
      <td>0.59</td>
      <td>0.73</td>
      <td>10.13</td>
      <td>0.12</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>UVnud200</th>
      <td>0.66</td>
      <td>0.80</td>
      <td>10.49</td>
      <td>0.12</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>UVnud200_tau30</th>
      <td>0.45</td>
      <td>0.49</td>
      <td>7.21</td>
      <td>0.10</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>UVnud200_tau10</th>
      <td>0.26</td>
      <td>0.34</td>
      <td>4.39</td>
      <td>0.08</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>units</th>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>deg</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [39]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span><span class="c1"># Errors with respect to reference simulation</span>
<span class="n">refsim</span> <span class="o">=</span> <span class="mi">1</span>

<span class="n">Metrics2</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="n">Nsim</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">)),</span>
                       <span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;REWS&#39;</span><span class="p">,</span><span class="s1">&#39;Shub&#39;</span><span class="p">,</span><span class="s1">&#39;WDhub&#39;</span><span class="p">,</span><span class="s1">&#39;alpha&#39;</span><span class="p">,</span><span class="s1">&#39;veer&#39;</span><span class="p">],</span>
                       <span class="n">index</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;MAE&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="n">simID</span><span class="p">)</span>
<span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="s1">&#39;units&#39;</span><span class="p">,:]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;m s-1&#39;</span><span class="p">,</span><span class="s1">&#39;deg&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">,</span><span class="s1">&#39;-&#39;</span><span class="p">])</span>
<span class="k">for</span> <span class="n">isim</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span><span class="n">Nsim</span><span class="p">):</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;REWS&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">REWS</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">REWS</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;Shub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">Shub</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">Shub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;WDhub&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">WDhub</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">WDhub</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;alpha&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">alpha</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">alpha</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>
    <span class="n">Metrics2</span><span class="o">.</span><span class="n">loc</span><span class="p">[(</span><span class="n">simID</span><span class="p">[</span><span class="n">isim</span><span class="p">]),</span><span class="s1">&#39;veer&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">veer</span><span class="p">[</span><span class="n">refsim</span><span class="p">],</span><span class="n">veer</span><span class="p">[</span><span class="n">isim</span><span class="p">],</span><span class="s1">&#39;False&#39;</span><span class="p">)</span>

<span class="n">tablecaption</span> <span class="o">=</span> <span class="p">(</span><span class="s2">&quot;**Table 2: $MAE_{ref}$ with respect to **&quot;</span> <span class="o">+</span><span class="n">simID</span><span class="p">[</span><span class="n">refsim</span><span class="p">])</span>
<span class="n">display</span><span class="p">(</span><span class="n">Markdown</span><span class="p">(</span><span class="n">tablecaption</span><span class="p">))</span>
<span class="n">display</span><span class="p">(</span><span class="n">Metrics</span><span class="p">)</span>

</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<strong>Table 2: :math:`MAE_{ref}` with respect to</strong>ke_T2</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>REWS</th>
      <th>Shub</th>
      <th>WDhub</th>
      <th>alpha</th>
      <th>veer</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>MAE</th>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
      <td>0.00</td>
    </tr>
    <tr>
      <th>WRF-YSU</th>
      <td>1.37</td>
      <td>1.48</td>
      <td>11.59</td>
      <td>0.13</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>ke_T2</th>
      <td>1.42</td>
      <td>1.54</td>
      <td>12.72</td>
      <td>0.14</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>Sl_T2</th>
      <td>1.87</td>
      <td>1.85</td>
      <td>11.40</td>
      <td>0.19</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>kl_T2</th>
      <td>1.84</td>
      <td>1.81</td>
      <td>10.88</td>
      <td>0.19</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>ke_T2wt</th>
      <td>1.40</td>
      <td>1.49</td>
      <td>12.71</td>
      <td>0.13</td>
      <td>0.08</td>
    </tr>
    <tr>
      <th>ke_Tsk</th>
      <td>1.63</td>
      <td>1.91</td>
      <td>16.39</td>
      <td>0.15</td>
      <td>0.10</td>
    </tr>
    <tr>
      <th>ke_T2obs</th>
      <td>1.75</td>
      <td>1.77</td>
      <td>11.66</td>
      <td>0.12</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>noTadv</th>
      <td>1.44</td>
      <td>1.30</td>
      <td>13.77</td>
      <td>0.17</td>
      <td>0.06</td>
    </tr>
    <tr>
      <th>noTadvUadv</th>
      <td>1.76</td>
      <td>1.87</td>
      <td>11.78</td>
      <td>0.18</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>noTadvUadv_Sg0</th>
      <td>3.21</td>
      <td>3.20</td>
      <td>16.17</td>
      <td>0.29</td>
      <td>0.12</td>
    </tr>
    <tr>
      <th>UVTnud80</th>
      <td>1.42</td>
      <td>1.36</td>
      <td>10.33</td>
      <td>0.14</td>
      <td>0.07</td>
    </tr>
    <tr>
      <th>UVTnud120</th>
      <td>1.26</td>
      <td>1.17</td>
      <td>11.85</td>
      <td>0.14</td>
      <td>0.09</td>
    </tr>
    <tr>
      <th>UVTnud200</th>
      <td>0.71</td>
      <td>0.76</td>
      <td>9.36</td>
      <td>0.09</td>
      <td>0.04</td>
    </tr>
    <tr>
      <th>UVTnud200_tau10</th>
      <td>0.16</td>
      <td>0.19</td>
      <td>3.80</td>
      <td>0.05</td>
      <td>0.02</td>
    </tr>
    <tr>
      <th>UVnud400</th>
      <td>0.59</td>
      <td>0.73</td>
      <td>10.13</td>
      <td>0.12</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>UVnud200</th>
      <td>0.66</td>
      <td>0.80</td>
      <td>10.49</td>
      <td>0.12</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>UVnud200_tau30</th>
      <td>0.45</td>
      <td>0.49</td>
      <td>7.21</td>
      <td>0.10</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>UVnud200_tau10</th>
      <td>0.26</td>
      <td>0.34</td>
      <td>4.39</td>
      <td>0.08</td>
      <td>0.05</td>
    </tr>
    <tr>
      <th>units</th>
      <td>m s-1</td>
      <td>m s-1</td>
      <td>deg</td>
      <td>-</td>
      <td>-</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
</div>
<div class="section" id="Discussion">
<h2>Discussion<a class="headerlink" href="#Discussion" title="Permalink to this headline">¶</a></h2>
<p>See discussion about results in [2].</p>
</div>
<div class="section" id="Conclusions">
<h2>Conclusions<a class="headerlink" href="#Conclusions" title="Permalink to this headline">¶</a></h2>
<p>The GABLS3 diurnal cycle case has been revisited and evaluated in terms
of wind energy specific metrics. Instead of using the adjusted mesoscale
tendencies of the original GABLS3 set-up, the mesoscale tendencies
computed by WRF are directly used to force the SCM. Momentum budget
analysis shows the relative importance of the different forcing terms in
the momentum equations. By spatial and temporal averaging, the
high-frequency fluctuations due to microscale effects are filtered out.
Using mesoscale tendencies to drive the SCM results in consistent flow
fields compared to the WRF simulation, even though the more simplified
physics of the ABL.</p>
<p>By sensitivity analysis on the mesoscale tendencies, it is shown that
the main driver of the ABL is the time and height dependent horizontal
pressure gradient. Advection terms come with high uncertainties and
hour-to-hour they can lead to large errors. Nevertheless, their impact
in terms of quantities of interest’s aggregated errors is positive.</p>
<p>The <span class="math">\(k-\epsilon\)</span> model of Sogachev et al. (2012) presents better
performance than the lower-order turbulence closure models. Considering
surface boundary conditions for the potential temperature equation,
prescribing the surface temperature by indirectly introducing the WRF
2-m temperature with MOST is more adequate than using the skin
temperature or the observed 2-m temperature.</p>
<p>Instead of adjusting at mesoscale, corrections are introduced at
microscale through observational profile nudging, to make use of the
routine measurements collected in wind energy campaigns. Mast-based and
lidar-based profiler set-ups are compared to show the added value of
measuring at greater heights than the hub-height, main advantage of
lidar systems. Sensitivity to the nudging time-scale is large, specially
to compensate errors introduced by the mesoscale advection forcing.</p>
</div>
<div class="section" id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<p>[1] Sanz Rodrigo J, Churchfield M, Kosovic B (2016) A wind energy
benchmark for ABL modeling of a diurnal cycle with a nocturnal low-level
jet: GABLS3 revisited. Journal of Physics: Conference Series 753,
032024, doi:10.1088/1742-6596/753/3/032024</p>
<p>[2] Sanz Rodrigo J, Churchfield M, Kosovic B (2017) A methodology for
the design and testing of atmospheric boundary layer models for wind
energy applications. Wind Energ. Sci. 2: 1-20, doi:10.5194/wes-2-1-2017</p>
<p>[3] Sogachev A, Kelly M, Leclerc MY (2012) Consistent Two-Equation
Closure Modelling for Atmospheric Research: Buoyancy and Vegetation
Implementations. Boundary-Layer Meteorol. 145(2): 307–327,
doi:10.1007/s10546-012-9726-5,2012.</p>
</div>
<div class="section" id="Acknowledgements">
<h2>Acknowledgements<a class="headerlink" href="#Acknowledgements" title="Permalink to this headline">¶</a></h2>
<p>This work was produced with funding from the ‘MesoWake’ Marie Curie
International Outgoing Fellowship (FP7-PEOPLE-2013-IOF, European
Commission’s grant agreement number 624562).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none"><div class="highlight"><pre>
<span></span>In [ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython2"><div class="highlight"><pre>
<span></span>
</pre></div>
</div>
</div>
</div>
</div>


      </div>
    </div>
  </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../../../../index.html">
    <img class="logo" src="../../../../_static/IEA_Wind_Logo.png" alt="Logo"/>
    
  </a>
</p>








<br>
<p>
Validate your code together with your peers and share your data safely to contribute to a traceable international model evaluation framework for the development of trustful wind energy engineering tools.
</p>
<br>
<h3>Navigation</h3>

<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html">Introduction</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#scope-and-objectives">Scope and Objectives</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#terminology">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#quick-guide">Quick Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#validation-directed-program">Validation Directed Program</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#verification">Verification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#validation">Validation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#uncertainty-quantification">Uncertainty Quantification</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#blind-testing">Blind Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#documenting">Documenting</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#data-provision">Data Provision</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../../mep/mep.html#references">References</a></li>
</ul>
<ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../../../index.html">Wind Conditions</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#mep-implementation">MEP Implementation</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#challenges">Challenges</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="../../../index.html#benchmarks">Benchmarks</a></li>
<li class="toctree-l2"><a class="reference internal" href="../../../index.html#open-source-models">Open Source Models</a></li>
</ul>
</li>
</ul>



<br>

<h3>Communities</h3>

<br>

<h3>Useful Links</h3>
<ul>
  <li><a href="https://community.ieawind.org/home">IEA-Wind</a></li>
  <li><a href="https://windbench.net/">Windbench</a></li>
</ul>

<h3>Join our mailing list</h3>

<!-- Begin MailChimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/classic-10_7.css" rel="stylesheet" type="text/css">
<style type="text/css">
    #mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; }
    /* Add your own MailChimp form style overrides in your site stylesheet or in this style block.
       We recommend moving this block and the preceding CSS link to the HEAD of your HTML file. */
</style>
<div id="mc_embed_signup">
<form action="https://cener.us15.list-manage.com/subscribe/post?u=c93006a14497a28dc43ad2062&amp;id=5918172b7e" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
    <div id="mc_embed_signup_scroll">
<div class="indicates-required"><span class="asterisk">*</span> indicates required</div>
<div class="mc-field-group">
    <label for="mce-EMAIL">Email Address  <span class="asterisk">*</span>
</label>
    <input type="email" value="" name="EMAIL" class="required email" id="mce-EMAIL">
</div>
<div class="mc-field-group">
    <label for="mce-FNAME">First Name </label>
    <input type="text" value="" name="FNAME" class="" id="mce-FNAME">
</div>
<div class="mc-field-group">
    <label for="mce-LNAME">Last Name </label>
    <input type="text" value="" name="LNAME" class="" id="mce-LNAME">
</div>
    <div id="mce-responses" class="clear">
        <div class="response" id="mce-error-response" style="display:none"></div>
        <div class="response" id="mce-success-response" style="display:none"></div>
    </div>    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_c93006a14497a28dc43ad2062_5918172b7e" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Subscribe" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>
<script type='text/javascript' src='//s3.amazonaws.com/downloads.mailchimp.com/js/mc-validate.js'></script><script type='text/javascript'>(function($) {window.fnames = new Array(); window.ftypes = new Array();fnames[0]='EMAIL';ftypes[0]='email';fnames[1]='FNAME';ftypes[1]='text';fnames[2]='LNAME';ftypes[2]='text';}(jQuery));var $mcj = jQuery.noConflict(true);</script>
<!--End mc_embed_signup-->


<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <div><input type="text" name="q" /></div>
      <div><input type="submit" value="Go" /></div>
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
  <div class="footer">
      <div class="container">
          <span style="float: left;">© Windbench 2018 </span>
          <span style="float: left;">
            &nbsp;<a rel="license" href="http://creativecommons.org/licenses/by-nc-sa/4.0/"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/80x15.png" /></a>
          </span>
          <span id="social-footer" class="pull-right">
            <span><a href="mailto:jsrodrigo@cener.com"><i class="iconf-email"></i>jsrodrigo@cener.com</a></span> |
            <span><a href="https://github.com/windbench/MEP"><i class="iconf-github-circled-alt2"></i>GitHub</a></span> |
            <span><a href="../../../../code-of-conduct.html">Code&nbsp;of&nbsp;Conduct</a></span>
          </span>
      </div>

    
    <a href="https://github.com//" class="github">
        <img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_darkblue_121621.png" alt="Fork me on GitHub"  class="github"/>
    </a>
    

</div>
  </body>
</html>